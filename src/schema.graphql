# Schema für API mit "GraphQL SDL" (SDL: Schema Definition Language).
#
# Es gibt folgende Datentypen: String, Int, Float, Boolean, ID; die IDs sind unique identifiers (Strings).
# Ausrufezeichen nach Typ steht für  Not-Null, [typ] für Listen.
#
# Werkzeuge:
# * Syntax-Checker: https://www.leskoff.com/s01929-0
# * Extension für VSCode: https://marketplace.visualstudio.com/items?itemName=GraphQL.vscode-graphql-syntax
#
# SDL-Referenz: https://graphql.org/learn/schema/
#
# Operationstypen: query, mutation, subscription

type Artikel {
  id               : ID!
  name             : String!
  beschreibung     : String
  menge            : Int!
  preis            : Float!
  grosskundenrabatt: Boolean!
}


# "Query" ist der Operationstyp für alle GraphQL-Lese-Anfragen ("R" in "CRUD")
type Query {

  # alle Artikel holen
  artikelAlle: [ Artikel! ]!

  # Artikel anhand ID abfragen
  artikel( id: ID! ): Artikel

  # Volltextsuche in Artikel (Name und Beschreibung)
  artikelSuche( query: String! ): [ Artikel! ]!
}


# "Mutation" ist der Operationstyp für alle GraphQL-Schreib-Anfragen ("C", "U", "D" in "CRUD")
type Mutation {

  # Neuen Artikel hinzufügen
  artikelHinzufuegen( name             : String!, 
                      beschreibung     : String, 
                      menge            : Int!, 
                      preis            : Float!, 
                      grosskundenrabatt: Boolean = false 
                    ): Artikel!

  # Artikel löschen
  artikelLoeschen( artikelId: ID! ): Artikel

  # Artikel-Attribute in einem Schritt aktualisieren
  artikelAktualisieren( artikelId: ID!, input: ArtikelUpdateInput! ): Artikel!
}


# Input-Typ für flexible Aktualisierungen (alle Felder optional)
input ArtikelUpdateInput {
  name             : String
  beschreibung     : String
  menge            : Int
  preis            : Float
  grosskundenrabatt: Boolean
}

# Änderungsart als Enum, für unified Subscription
enum Aenderungsart {
  HINZUGEFUEGT
  AKTUALISIERT
  GELOESCHT
}

# Payload für einheitliche Änderungen-Subscription
type ArtikelAenderung {
  art    : Aenderungsart!
  felder : [ String! ]!
  artikel: Artikel!
}


# "Subscription" ist der Operationstyp für Echtzeit-Updates
type Subscription {

  # Ein Subscription-Typ für alle Arten von Änderungen
  artikelGeaendert: ArtikelAenderung!
}
